<!DOCTYPE html>
<html>
<head>
    <title>Pembuat API Key</title>
    <style>
        body { background: #ffe4ef; font-family: sans-serif; }
        .card { width: 350px; padding: 20px; background: white; margin: auto; margin-top: 80px;
                border-radius: 12px; text-align: center; }
        button { width: 100%; padding: 12px; border: none; margin-top: 10px; 
                 background: #ff4081; color: white; border-radius: 8px; cursor: pointer; }
        input, textarea { width: 100%; padding: 10px; margin-top: 10px; border-radius: 8px;
                          border: 1px solid #ccc; }
    </style>
</head>

<body>

<div class="card">

    <h2>Buat API Key</h2>

    <button onclick="generate()">Create API Key</button>

    <textarea id="apikey" rows="3" readonly>API Key akan muncul di sini...</textarea>

    <h3>Data User</h3>
    <input type="text" id="firstname" placeholder="First Name">
    <input type="text" id="lastname" placeholder="Last Name">
    <input type="email" id="email" placeholder="Email">

    <button onclick="saveUser()">Save User</button>

</div>

<script>
let apiId = null;

function generate() {
    fetch("/generate", { method: "POST" })
    .then(res => res.json())
    .then(data => {
        apiId = data.id;
        document.getElementById("apikey").value = data.api_key;
    });
}

function saveUser() {
    const body = {
        first_name: document.getElementById("firstname").value,
        last_name: document.getElementById("lastname").value,
        email: document.getElementById("email").value,
        api_key_id: apiId
    };

    fetch("/save-user", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(body)
    })
    .then(res => res.json())
    .then(msg => alert(msg.message));
}
</script>

</body>
</html>
